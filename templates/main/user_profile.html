<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ user.name }}さんのプロフィール</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container py-4">
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-8">
          <!--   <div class="col-12 col-sm-10 col-md-8 col-lg-6">  -->
          <div class="card profile-card bg-white">
            <!-- 星のお気に入りボタン -->
            <span
              class="favorite-btn"
              id="favoriteBtn"
              onclick="toggleFavorite()"
              >★</span
            >

            <!-- 画像 -->
            <img
              src="{{ url_for('static', filename=user.image_path) if user.image_path else 'https://via.placeholder.com/600x300' }}"
              class="card-img-top"
              alt="{{ user.name }}"
            />

            <!-- プロフィール情報 -->
            <div class="card-body">
              <h4 class="card-title text-center">{{ user.name }} さん</h4>

              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  <strong>性別:</strong> {{ user.gender or '未設定' }}
                </li>
                <li class="list-group-item">
                  <strong>言語:</strong> {{ user.language }}
                </li>
                <li class="list-group-item">
                  <strong>開発分野:</strong> {{ user.field }}
                </li>
                <li class="list-group-item">
                  <strong>学習歴:</strong> {{ user.experience or '非公開' }}
                </li>
                <li class="list-group-item">
                  <strong>自己紹介:</strong><br />{{ user.description or
                  'まだ自己紹介がありません。' }}
                </li>
              </ul>

              <!-- ▼ 閉じるボタンをカードの下中央に -->
              <div class="close-bottom">
                <button onclick="window.history.back()">× 閉じる</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JS：お気に入りボタン制御 -->
    <!-- 
  <script>
    function toggleFavorite() {
      const btn = document.getElementById("favoriteBtn");
      btn.classList.toggle("active");

      // TODO: Flaskへ通知送信（APIやPOST）
		
      // fetch(`/favorite/{{ user.id }}`, { method: 'POST' })
    }
  </script>
	-->
    <!-- JSのtoggleFavorite()内で、相手ユーザーのID（user.id）を使ってPOSTリクエストを送ります -->
    <!--  {{ user.id }} がテンプレートで正しく渡っていることが前提 -->

    <script>
      function toggleFavorite() {
        const btn = document.getElementById("favoriteBtn");
        btn.classList.toggle("active");

        // Flaskに通知用のPOSTリクエストを送信
        fetch("/favorite/{{ user.id }}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            target_user_id: "{{ user.id }}",
          }),
        })
          .then((response) => {
            if (!response.ok) throw new Error("リクエスト失敗");
            return response.json();
          })
          .then((data) => {
            console.log("通知が送信されました:", data.message);
          })
          .catch((error) => {
            console.error("通知送信エラー:", error);
          });
      }
    </script>

    <!-- JSのtoggleFavorite()内で、相手ユーザーのID（user.id）を使ってPOSTリクエストを送ります -->
  </body>
</html>
